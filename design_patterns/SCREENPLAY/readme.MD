# ğŸ­ SCREENPLAY com Playwright e Pytest

Guia passo a passo para configurar, entender e executar o projeto de testes automatizados usando Playwright com o padrÃ£o Screenplay.

## 1. ğŸ¯ VisÃ£o geral

- **Objetivo**: automatizar cenÃ¡rios de login no site Sample App aplicando o padrÃ£o Screenplay em Python.
- **Tecnologias**: Playwright (API sÃ­ncrona), Pytest, Xdist (execuÃ§Ã£o paralela) e relatÃ³rios padrÃµes do Playwright Test Runner.
- **PapÃ©is**: `tasks` executam aÃ§Ãµes na pÃ¡gina, `questions` validam resultados e `actors` coordenam esses comportamentos.

## 2. ğŸ“š O PadrÃ£o Screenplay - Explicado em Detalhes

### ğŸ¤” O que Ã© Screenplay?

Screenplay Ã© um padrÃ£o de design para testes de automaÃ§Ã£o que organiza o cÃ³digo seguindo a metÃ¡fora de uma **peÃ§a de teatro**:
- **Ator**: o personagem que executa as aÃ§Ãµes.
- **Tasks (Tarefas)**: o que o ator faz (aÃ§Ãµes).
- **Questions (QuestÃµes)**: o que o ator observa ou valida (verificaÃ§Ãµes).
- **Ability (Habilidade)**: como o ator executa as aÃ§Ãµes (ex.: interagir com a pÃ¡gina web via Playwright).

### Estrutura BÃ¡sica

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Teste (test_login.py)         â”‚
â”‚                                         â”‚
â”‚  Arrange  â†’ Actor.prepare()             â”‚
â”‚  Act      â†’ actor.tasks.realizar_login()â”‚
â”‚  Assert   â†’ actor.questions.validar()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Actor (actors/actor.py)        â”‚
â”‚   (Coordenador de Tasks e Questions)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†™                               â†˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tasks               â”‚  â”‚  Questions           â”‚
â”‚  (O que fazer)       â”‚  â”‚  (O que observar)    â”‚
â”‚                      â”‚  â”‚                      â”‚
â”‚ â€¢ acessar_pagina()   â”‚  â”‚ â€¢ mensagem_boas_     â”‚
â”‚ â€¢ realizar_login()   â”‚  â”‚   vindas()           â”‚
â”‚ â€¢ fechar_pagina()    â”‚  â”‚ â€¢ campo_habilitado() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ability: Playwright Page                â”‚
â”‚   (Capacidade tÃ©cnica do ator)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âœ… Vantagens do Screenplay

1. **Leitura Natural**: Os testes leem como um cenÃ¡rio, nÃ£o como comandos tÃ©cnicos.
   ```python
   # Sem Screenplay (imperativo):
   page.goto("...")
   page.get_by_placeholder(...).fill(...)
   page.get_by_role(...).click()
   
   # Com Screenplay (descritivo):
   login_task.realizar_login("dan", "pwd")
   login_question.mensagem_de_boas_vindas("dan")
   ```

2. **ReutilizaÃ§Ã£o**: Tasks e questions sÃ£o componentes independentes reutilizÃ¡veis.
   - Uma task pode ser usada em mÃºltiplos testes.
   - MudanÃ§as na tela sÃ³ afetam a task correspondente.

3. **ManutenÃ§Ã£o Simplificada**: MudanÃ§as na interface afetam apenas uma task/question.
   - CentralizaÃ§Ã£o de seletores evita repetiÃ§Ãµes.
   - Um Ãºnico lugar para ajustar lÃ³gica.

4. **Escalabilidade**: FÃ¡cil adicionar novos cenÃ¡rios sem duplicaÃ§Ã£o.
   - Novas combinaÃ§Ãµes de tasks/questions com reutilizaÃ§Ã£o.
   - Arquitetura clara para times maiores.

5. **Legibilidade**: O cÃ³digo comunica intenÃ§Ã£o, nÃ£o implementaÃ§Ã£o.

### ğŸ”§ Componentes Principais

#### âœï¸ A) Tasks (Tarefas - O Que Fazer)

Tasks encapsulam **aÃ§Ãµes** que o usuÃ¡rio executa na pÃ¡gina.

```python
# tasks/login_task.py
class LoginTask:
    def __init__(self, page: Page):
        self.page = page
    
    def acessar_pagina_login(self):
        """Tarefa: Navegar para a pÃ¡gina de login"""
        self.page.goto("http://uitestingplayground.com/sampleapp")
    
    def realizar_login(self, username: str, password: str):
        """Tarefa: Preencher formulÃ¡rio e clicar em Login"""
        username_input = self.page.get_by_placeholder("User Name")
        password_input = self.page.locator("input[name=\"Password\"]")
        login_btn = self.page.get_by_role("button", name="Log In")
        
        username_input.fill(username)
        password_input.fill(password)
        login_btn.click()
    
    def fechar_pagina(self):
        """Tarefa: Fechar a pÃ¡gina"""
        self.page.close()
```

**Boas prÃ¡ticas para Tasks:**
- Um mÃ©todo = uma aÃ§Ã£o lÃ³gica (micro-tasks).
- Nomes descritivos no imperativo (realizar_login, acessar_pagina).
- Centralizar todos os seletores.
- Sem assertions/validaÃ§Ãµes (isso Ã© funÃ§Ã£o de questions).

#### ğŸ” B) Questions (QuestÃµes - O Que Observar)

Questions encapsulam **validaÃ§Ãµes** e **verificaÃ§Ãµes** de estado.

```python
# questions/login_question.py
from playwright.sync_api import expect

class LoginQuestion:
    def __init__(self, page: Page):
        self.page = page
    
    def mensagem_de_boas_vindas(self, username: str):
        """QuestÃ£o: A mensagem de boas-vindas aparece corretamente?"""
        label = self.page.locator("label#loginstatus")
        expect(label).to_have_text(f"Welcome, {username}!")
    
    def campo_senha_visivel(self):
        """QuestÃ£o: O campo de senha estÃ¡ visÃ­vel?"""
        password_field = self.page.locator("input[name=\"Password\"]")
        expect(password_field).to_be_visible()
```

**Boas prÃ¡ticas para Questions:**
- Nomes interrogativos semÃ¢nticos (mensagem_de_boas_vindas, usuario_logado).
- Usar `expect` do Playwright para sincronizaÃ§Ã£o e legibilidade.
- Uma verificaÃ§Ã£o clara por mÃ©todo.
- Sem efeitos colaterais (leitura apenas).

#### ğŸ¬ C) Actor (Ator - Quem Executa)

Actor Ã© o orquestrador que:
- Encapsula o acesso a tasks e questions.
- Gerencia habilidades (abilities) do ator.
- Conecta o ator ao navegador.

```python
# actors/actor.py
class Actor:
    def web_perform(self, task):
        """Ability: Executar aÃ§Ãµes na web"""
        return self.browser_type_launch_args(task)
    
    def browser_type_launch_args(self, browser_type_launch_args):
        """Configura navegador do ator"""
        return {
            **browser_type_launch_args,
            "headless": False,  # Ator vÃª o que faz
        }

def prepare_actor_login_task(page):
    """Factory: Ator com habilidade de realizar login"""
    return LoginTask(page)

def prepare_actor_login_question(page):
    """Factory: Ator com habilidade de verificar login"""
    return LoginQuestion(page)
```

### ğŸ“‹ D) Teste - OrquestraÃ§Ã£o Final

O teste monta a histÃ³ria completa:

```python
# tests/test_login.py
def test_ct001_realizar_login_com_sucesso(page: Page):
    # ARRANGE: Preparar o ator com suas habilidades
    login_task = prepare_actor_login_task(page)
    login_question = prepare_actor_login_question(page)
    
    # ACT: Ator executa tarefas (Tasks)
    login_task.acessar_pagina_login()
    login_task.realizar_login("dan", "pwd")
    
    # ASSERT: Ator valida resultado (Questions)
    login_question.mensagem_de_boas_vindas("dan")
    
    # CLEANUP: Fechar
    login_task.fechar_pagina()
```

**Fluxo AAA (Arrange-Act-Assert):**
1. **Arrange**: Preparar o ator e seu contexto.
2. **Act**: Executar aÃ§Ãµes (tasks).
3. **Assert**: Validar resultado (questions).

### Exemplo Expandido: Adicionar Novo Cenario

Se quiser testar logout:

1. **Criar task em `LoginTask`**:
   ```python
   def realizar_logout(self):
       logout_btn = self.page.get_by_role("button", name="Log Out")
       logout_btn.click()
   ```

2. **Criar question em `LoginQuestion`**:
   ```python
   def usuario_deslogado(self):
       label = self.page.locator("label#loginstatus")
       expect(label).to_have_text("User logged out.")
   ```

3. **Usar no teste**:
   ```python
   login_task.realizar_logout()
   login_question.usuario_deslogado()
   ```

Sem duplicaÃ§Ã£o, sem mudanÃ§a na arquitetura. Puro Screenplay!

## 3. ğŸ“‹ Requisitos

- Python 3.10 ou superior.
- Pip atualizado (`python -m pip install --upgrade pip`).
- Playwright com navegadores instalados (`playwright install`).
- Sistema operacional testado: Windows (funciona tambÃ©m em Linux e macOS com os mesmos comandos bash).

## 4. ğŸš€ Passo a passo de configuraÃ§Ã£o

1. **Clonar o repositÃ³rio**
	```bash
	git clone <url-do-repositorio>
	cd automation_playwright_python/design_patterns/SCREENPLAY
	```
2. **Criar ambiente virtual (recomendado)**
	```bash
	python -m venv .venv
	source .venv/Scripts/activate  # PowerShell: .venv\Scripts\Activate.ps1
	```
3. **Instalar dependÃªncias Python**
	- Se houver arquivo de requisitos, execute `pip install -r requirements.txt`.
	- Caso contrÃ¡rio, instale diretamente:
	  ```bash
	  pip install playwright pytest pytest-playwright pytest-xdist
	  ```
4. **Instalar navegadores do Playwright**
	```bash
	playwright install
	```
5. **Configurar variÃ¡veis adicionais (se necessÃ¡rio)**
	- NÃ£o hÃ¡ variÃ¡veis obrigatÃ³rias por padrÃ£o; ajuste apenas se o ambiente exigir proxy ou credenciais distintas.

## 5. ğŸ“‚ Entendendo a estrutura

- `actors/actor.py`: cria o ator e prepara tasks/questions. Ajusta configuraÃ§Ã£o do navegador (ex.: modo headless).
- `tasks/login_task.py`: encapsula cada interaÃ§Ã£o com a pÃ¡gina (acessar, logar, fechar).
- `questions/login_question.py`: valida mensagens ou estados esperados apÃ³s as aÃ§Ãµes.
- `tests/test_login.py`: cenÃ¡rio de teste que orquestra tasks e questions.
- `tests/conftest.py`: fixture Pytest para adaptar `browser_type_launch_args` ao ator (habilita navegaÃ§Ã£o visÃ­vel).
- `pytest.ini`: define navegadores, paralelismo, coleta de evidÃªncias e pasta `test-reports/`.

## 6. ğŸ§ª Executando os testes

1. Certifique-se de que o ambiente virtual esteja ativo e dependÃªncias instaladas.
2. Execute os testes com pytest:
	```bash
	pytest
	```
	- O arquivo `pytest.ini` jÃ¡ configura a execuÃ§Ã£o nos navegadores Chromium, Firefox e WebKit, alÃ©m de paralelismo (`--numprocesses 4`).
	- Screenshots, vÃ­deos e traces sÃ£o capturados somente em caso de erro e sÃ£o salvos em `test-reports/`.
3. Para limitar navegadores ou desativar paralelismo, sobrescreva os argumentos:
	```bash
	pytest --browser chromium --numprocesses 1
	```

## 7. ğŸ¨ Como expandir cenÃ¡rios

- **Novas tasks**: crie um mÃ©todo em `tasks/` para cada aÃ§Ã£o pequena e reutilizÃ¡vel.
- **Novas questions**: verifique estados finais (mensagens, elementos visÃ­veis) em `questions/` usando `expect`.
- **Novos testes**: componha tasks e questions no estilo Arrange-Act-Assert em `tests/`.
- Mantenha os nomes autoexplicativos para facilitar leitura e manutenÃ§Ã£o.

## 8. ğŸ’¡ Boas prÃ¡ticas

- Centralize seletores nas tasks para facilitar manutenÃ§Ã£o.
- Evite sleeps; prefira `expect` com Playwright para sincronizaÃ§Ã£o.
- Reaproveite ao mÃ¡ximo tasks/questions entre cenÃ¡rios semelhantes.
- Automatize formataÃ§Ã£o/linters (ex.: `ruff`, `black`) se o projeto crescer.

## 9. ğŸ”§ SoluÃ§Ã£o de problemas

- **Erro de navegadores ausentes**: reexecute `playwright install`.
- **Ambiente virtual nÃ£o ativa**: confira o caminho correto do script de ativaÃ§Ã£o conforme o shell.
- **Timeouts**: ajuste `page.set_default_timeout` dentro das tasks ou passe `--timeout` ao pytest.
- **ExecuÃ§Ã£o lenta**: reduza navegadores via `--browser` ou desative vÃ­deos/traces temporariamente.

## 10. ğŸš€ PrÃ³ximos passos sugeridos

- Adicionar pipeline CI para executar os testes automaticamente.
- Gerar relatÃ³rios enriquecidos (ex.: Allure) com integraÃ§Ã£o ao Pytest.
- Documentar credenciais e ambientes de testes caso vÃ¡ alÃ©m do Sample App.
